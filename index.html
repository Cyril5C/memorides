<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Memorides</title>

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Memorides">
    <link rel="manifest" href="/manifest.json">

    <!-- Apple Touch Icons (use icon.svg for now, create PNG later) -->
    <link rel="apple-touch-icon" href="/icon.svg">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/icon.svg">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <!-- Map View -->
        <div id="mapView" class="view-container active">
            <div id="map"></div>
        </div>

        <!-- Floating Add Button -->
        <button class="fab" id="fabButton" title="Ajouter une trace"></button>
    </div>

    <!-- Photo Modal -->
    <div id="photoModal" class="modal hidden">
        <div class="modal-content">
            <button class="modal-close" id="closeModal"></button>
            <img id="modalImage" src="" alt="">
            <div class="modal-info">
                <h3 id="modalPhotoName"></h3>
                <p id="modalPhotoLocation"></p>
            </div>
            <button id="deletePhotoBtn" class="btn-danger">Supprimer cette photo</button>
        </div>
    </div>

    <!-- Upload Modal -->
    <div id="uploadModal" class="modal hidden">
        <div class="modal-content modal-form">
            <button class="modal-close" id="closeUploadModal"></button>
            <h3>Ajouter une trace GPX</h3>
            <div class="upload-options">
                <label class="upload-option-btn">
                    <input type="file" id="gpxUploadFab" accept=".gpx" multiple hidden>
                    üìÅ S√©lectionner fichier(s) GPX
                </label>
            </div>
            <p style="color: var(--text-secondary); font-size: 0.85rem; margin-top: 1rem; text-align: center;">
                Les photos peuvent √™tre ajout√©es depuis l'√©dition d'une trace
            </p>
        </div>
    </div>

    <!-- Track Info Modal -->
    <div id="trackInfoModal" class="modal hidden">
        <div class="modal-content modal-form">
            <button class="modal-close" id="closeTrackInfoModal"></button>
            <div id="trackInfoContent">
                <h3 id="trackInfoTitle"></h3>
                <div class="track-info-stats">
                    <div class="track-stat-item">
                        <span class="track-stat-label">Distance:</span>
                        <span id="trackInfoDistance" class="track-stat-value"></span>
                    </div>
                    <div class="track-stat-item">
                        <span class="track-stat-label">D√©nivel√©:</span>
                        <span id="trackInfoElevation" class="track-stat-value"></span>
                    </div>
                    <div class="track-stat-item">
                        <span class="track-stat-label">Dur√©e:</span>
                        <span id="trackInfoDuration" class="track-stat-value"></span>
                    </div>
                    <div class="track-stat-item">
                        <span class="track-stat-label">Statut:</span>
                        <span id="trackInfoCompleted" class="track-stat-value"></span>
                    </div>
                </div>
                <div id="trackInfoLabelsContainer" class="track-info-labels" style="display: none;">
                    <h4>Libell√©s</h4>
                    <div id="trackInfoLabels" class="labels-display-readonly"></div>
                </div>
                <div id="trackInfoCommentsContainer" class="track-info-comments" style="display: none;">
                    <h4>Commentaires</h4>
                    <p id="trackInfoComments"></p>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-primary" id="editTrackFromInfo">‚úèÔ∏è Modifier</button>
                    <button class="btn btn-secondary" id="downloadTrackFromInfo">‚¨áÔ∏è T√©l√©charger GPX</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Track Edit Modal -->
    <div id="trackEditModal" class="modal hidden">
        <div class="modal-content modal-form">
            <button class="modal-close" id="closeTrackEditModal"></button>
            <h3>√âditer la trace</h3>
            <form id="trackEditForm">
                <div class="form-group">
                    <label for="editTrackTitle">Titre:</label>
                    <input type="text" id="editTrackTitle" placeholder="Titre de la trace">
                </div>
                <div class="form-group">
                    <label for="editTrackType">Type:</label>
                    <select id="editTrackType">
                        <option value="hiking">Randonn√©e</option>
                        <option value="cycling">V√©lo</option>
                        <option value="gravel">Gravel</option>
                        <option value="road">Route</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editTrackColor">Couleur de la trace:</label>
                    <input type="color" id="editTrackColor" value="#2563eb">
                </div>
                <div class="form-group">
                    <label for="editTrackCompletedAt">Date de r√©alisation (laisser vide si projet) :</label>
                    <input type="date" id="editTrackCompletedAt" placeholder="JJ/MM/AAAA">
                </div>
                <div class="form-group">
                    <label>Libell√©s:</label>
                    <div class="labels-container">
                        <div id="labelsDisplay" class="labels-display"></div>
                        <div class="label-input-group">
                            <input type="text" id="newLabel" placeholder="Ajouter un libell√©..." class="label-input">
                            <button type="button" class="btn btn-primary btn-small" id="addLabelBtn">Ajouter</button>
                        </div>
                        <div id="labelsSuggestions" class="labels-suggestions">
                            <small style="color: var(--text-secondary); margin-bottom: 0.5rem; display: block;">Libell√©s existants:</small>
                            <div id="labelsSuggestionsContainer" class="labels-suggestions-container"></div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="editTrackComments">Commentaires:</label>
                    <textarea id="editTrackComments" rows="4" placeholder="Ajoutez vos commentaires..."></textarea>
                </div>
                <div class="form-group">
                    <label>Photos associ√©es:</label>
                    <div id="trackPhotosContainer" class="track-photos-grid">
                        <!-- Photos will be displayed here -->
                    </div>
                    <label class="btn btn-secondary btn-small" style="margin-top: 0.5rem;">
                        <input type="file" id="addTrackPhotos" accept="image/*" multiple hidden>
                        Ajouter des photos
                    </label>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Enregistrer</button>
                    <button type="button" class="btn btn-secondary" id="cancelTrackEdit">Annuler</button>
                    <button type="button" class="btn btn-danger" id="deleteTrackBtn">Supprimer la trace</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Leaflet Polyline Decorator for arrows -->
    <script src="https://cdn.jsdelivr.net/npm/leaflet-polylinedecorator@1.6.0/dist/leaflet.polylineDecorator.min.js"></script>

    <!-- EXIF reader for photo geotags -->
    <script src="https://cdn.jsdelivr.net/npm/exif-js"></script>

    <!-- Custom JS -->
    <script src="app.js"></script>

    <!-- PWA Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('Service Worker registered:', registration.scope);
                    })
                    .catch((error) => {
                        console.log('Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>
